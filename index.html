<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/mosque.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />

    <!-- Telegram Mini App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Meta for Telegram -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self' https://telegram.org https://*.telegram.org;
      script-src 'self' 'unsafe-inline' https://telegram.org;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src 'self' https://fonts.gstatic.com;
      img-src 'self' data: blob: https:;
      media-src 'self' data: blob:;
      frame-ancestors 'self' https://*.telegram.org https://telegram.org;
    " />

    <title>MubarakWay - Исламское мини-приложение</title>
    <meta name="description" content="Комплексное исламское приложение: библиотека книг, нашиды, определение киблы и время молитв" />

    <!-- Cache Busting for Development -->
    <script>
      // Clear cache on version change (only in development)
      const APP_VERSION = 'v1.0.6';
      const savedVersion = localStorage.getItem('app_version');

      if (savedVersion !== APP_VERSION) {
        console.log('New version detected, clearing cache...');

        // Clear Service Worker caches
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
          });
        }

        // Clear localStorage except important data
        const importantKeys = ['bookFavorites', 'bookmarks'];
        const tempStorage = {};
        importantKeys.forEach(key => {
          const value = localStorage.getItem(key);
          if (value) tempStorage[key] = value;
        });

        localStorage.clear();

        // Restore important data
        Object.keys(tempStorage).forEach(key => {
          localStorage.setItem(key, tempStorage[key]);
        });

        localStorage.setItem('app_version', APP_VERSION);

        // Reload page to get fresh content
        window.location.reload(true);
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
